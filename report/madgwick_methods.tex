\documentclass[bare_jrnl_transmag]{subfiles}
\begin{document}
\subsection{Madgwick Filter Implementation}
The Madgwick filter was implemented in Python to provide an orientation pose estimate. However, due to the nature of the drone's flight and real-world conditions, modifications were required to the original algorithm to ensure the filter was able to provide a stable orientation estimate. The modifications made to the Madgwick filter are described below.

\subsubsection{Gyroscope Bias Compensation}
Note that unlike other filters that are capable of measuring bias in the gyroscopic measurements (ex: MEKF), the Madgwick filter is not capable of doing so (though it can implicitly correct for bias within the correction step). As a result, the filter calculates the average gyroscopic bias on startup and subtracts these values before integrating them per Equation \ref{eq:madgwick_gyro_integration}.

\subsubsection{High Acceleration Compensation}
A key limitation of the Madgwick filter is that it assumes the accelerometer measurements are only affected by gravity, and not by any other forces acting on the drone. This assumption is not valid in all cases, especially when the drone is moving quickly or performing aggressive maneuvers. When evaluating the filter's performance in high acceleration scenarios on the tuning dataset, the orientation estimation was found to diverge significantly and increase the RSME. Given the context of the dataset is an FPV drone where high acceleration maneuvers are common, the correction step size $\mu$ was made to be adaptive to the accelerometer measurements. The algorithm for the adaptive step size is shown in below, with the parameters $x_1$, $x_2$, and $x_3$ being tuned heuristically. This change helped improve the orientation estimation in high acceleration scenarios, though it does show some divergence in the presence of high acceleration noise. The algorithm is as follows:

\[
\mu_{\text{out}} =
\begin{cases}
0 & \text{if } \|\mathbf{a}\| \leq x_1 \\
\mu \cdot \dfrac{\|\mathbf{a}\| - x_1}{x_2 - x_1} & \text{if } x_1 < \|\mathbf{a}\| \leq x_2 \\
\mu \cdot \dfrac{x_3 - \|\mathbf{a}\|}{x_3 - x_2} & \text{if } x_2 < \|\mathbf{a}\| \leq x_3 \\
0 & \text{if } \|\mathbf{a}\| > x_3
\end{cases}
\]

\[
\text{where } x_1 = 4.905, \quad x_2 = 9.81, \quad x_3 = 14.715
\]

\end{document}